<div class="server-detail" *ngIf="server; else loadingOrError">
  <div class="detail-header">
    <button mat-icon-button (click)="onBack()" class="back-button" matTooltip="Back to servers">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h2>
      <i [class]="getTypeIcon(server.type)" class="server-icon"></i>
      {{ server.name || server.id }}
    </h2>
    <div class="header-actions">
      <button mat-raised-button 
              color="primary" 
              *ngIf="server.status !== 'online'" 
              (click)="onStartServer()"
              [disabled]="loading">
        <mat-icon>play_arrow</mat-icon>
        Start
      </button>
      <button mat-raised-button 
              color="warn" 
              *ngIf="server.status === 'online'" 
              (click)="onStopServer()"
              [disabled]="loading">
        <mat-icon>stop</mat-icon>
        Stop
      </button>
    </div>
  </div>

  <mat-card class="server-card">
    <mat-card-header>
      <mat-card-title>Server Details</mat-card-title>
      <mat-card-subtitle>
        <span class="server-id">ID: {{ server.id }}</span>
        <span class="server-type">{{ getTypeDisplayName(server.type) }}</span>
      </mat-card-subtitle>
    </mat-card-header>
    
    <mat-card-content>
      <div class="detail-section">
        <h3>Status</h3>
        <div class="server-status">
          <div class="status-indicator" [ngClass]="getStatusClass(server.status)"></div>
          <span class="status-text">{{ server.status | titlecase }}</span>
        </div>
      </div>

      <div class="detail-section">
        <h3>Configuration</h3>
        <div class="config-grid">
          <div class="config-item">
            <span class="label">Command:</span>
            <span class="value code">{{ server.command }}</span>
          </div>
          <div class="config-item" *ngIf="server.args?.length">
            <span class="label">Arguments:</span>
            <span class="value code">{{ server.args.join(' ') }}</span>
          </div>
          <div class="config-item" *ngIf="server.cwd">
            <span class="label">Working Directory:</span>
            <span class="value code">{{ server.cwd }}</span>
          </div>
        </div>
      </div>

      <div class="detail-section" *ngIf="server.env?.length">
        <h3>Environment Variables</h3>
        <div class="env-vars">
          <div class="env-var" *ngFor="let env of server.env">
            <span class="env-name">{{ env }}</span>
          </div>
        </div>
      </div>

      <div class="detail-section">
        <div class="section-header">
          <h3>Available Tools</h3>
          <button mat-button color="primary" (click)="loadTools(server.id)" [disabled]="loadingTools">
            <mat-icon>refresh</mat-icon>
            Refresh
          </button>
        </div>
        
        <div *ngIf="loadingTools" class="loading-tools">
          <mat-spinner diameter="24"></mat-spinner>
          <span>Loading tools...</span>
        </div>
        
        <div *ngIf="!loadingTools && tools?.length > 0" class="tools-grid">
          <mat-card *ngFor="let tool of tools" class="tool-card">
            <mat-card-header>
              <mat-card-title>{{ tool.name }}</mat-card-title>
              <mat-card-subtitle>{{ tool.description || 'No description available' }}</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content *ngIf="tool.parameters?.length">
              <div class="tool-params">
                <div class="param" *ngFor="let param of tool.parameters">
                  <strong>{{ param.name }}</strong>: {{ param.type }}
                  <span *ngIf="param.required" class="required">*</span>
                  <p class="param-desc" *ngIf="param.description">{{ param.description }}</p>
                </div>
              </div>
            </mat-card-content>
            <mat-card-actions>
              <button mat-button color="primary" (click)="onExecuteTool(tool.name)" [disabled]="server.status !== 'online'">
                <mat-icon>play_arrow</mat-icon>
                Execute
              </button>
            </mat-card-actions>
          </mat-card>
        </div>
        
        <div *ngIf="!loadingTools && (!tools || tools.length === 0)" class="no-tools">
          <mat-icon>info</mat-icon>
          <span>No tools available for this server</span>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>

<ng-template #loadingOrError>
  <div class="loading-error-container">
    <div *ngIf="loading" class="loading-indicator">
      <mat-spinner diameter="40"></mat-spinner>
      <span>Loading server details...</span>
    </div>
    <div *ngIf="error" class="error-message">
      <mat-icon color="warn">error_outline</mat-icon>
      <span>{{ error }}</span>
      <button mat-button (click)="onBack()">Back to Servers</button>
    </div>
  </div>
</ng-template>
