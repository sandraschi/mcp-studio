name: Sync Wiki

on:
  push:
    branches: [ master ]
    paths:
      - 'docs/**'
  workflow_dispatch:

jobs:
  sync-wiki:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout main repo
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Checkout wiki
        uses: actions/checkout@v3
        with:
          repository: sandraschi/mcp-studio.wiki
          path: wiki

      - name: Sync docs to wiki
        run: |
          # Copy all markdown files from docs to wiki
          cp -r docs/*.md wiki/
          
          # Update Home.md if it exists
          if [ -f wiki/Home.md ]; then
            cp wiki/Home.md wiki/Home.md.bak
            echo "# MCP Studio Wiki" > wiki/Home.md
            echo "\nThis wiki is automatically synced from the main repository.\n" >> wiki/Home.md
            echo "## Available Pages\n" >> wiki/Home.md
            
            # Add links to all markdown files
            for file in wiki/*.md; do
              if [ "$(basename "$file")" != "Home.md" ] && [ "$(basename "$file")" != "_Sidebar.md" ]; then
                title=$(basename "$file" .md | tr '-' ' ' | sed 's/\b./\u&/g')
                echo "- [${title}]($(basename "$file"))" >> wiki/Home.md
              fi
            done
            
            # Add footer
            echo "\n---\n*Last updated: $(date -u +"%Y-%m-%d %H:%M:%S %Z")*" >> wiki/Home.md
          fi

      - name: Commit and push changes
        run: |
          cd wiki
          git config --global user.name 'GitHub Actions'
          git config --global user.email 'actions@github.com'
          git add .
          git diff --quiet && git diff --staged --quiet || {
            git commit -m "docs: update wiki from main repository"
            git push
          }
